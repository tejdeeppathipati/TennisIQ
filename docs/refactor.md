# Refactor Plan And Execution Log

## Goal
Remove duplicate legacy code paths while preserving a single canonical implementation under `tennisiq/` and keeping the repo runnable.

## Scope
- In scope:
  - Delete duplicate legacy code in `models/`.
  - Delete empty root `pipeline/` directory.
  - Update docs that still mention legacy code retention.
  - Validate imports and syntax after removal.
- Out of scope:
  - Deleting datasets in `data/`.
  - Deleting run artifacts in `outputs/`.
  - Altering model behavior.

## Canonical Paths (keep)
- `tennisiq/cv/ball/*`
- `tennisiq/cv/court/*`
- `tennisiq/pipeline/*`
- `tennisiq/geometry/*`
- `tennisiq/io/*`
- `scripts/*`
- `docs/*`

## Duplicate / Legacy Paths (remove)
- `models/TennisCourtDetector/*`
- `models/TrackNet/*`
- `models/.DS_Store`
- root `pipeline/` (empty)

## Mapping (legacy -> canonical)
- `models/TrackNet/model.py` -> `tennisiq/cv/ball/model.py`
- `models/TrackNet/datasets.py` -> `tennisiq/cv/ball/dataset.py`
- `models/TrackNet/main.py` -> `tennisiq/cv/ball/train.py`
- `models/TrackNet/infer_on_video.py` -> `tennisiq/cv/ball/infer.py`
- `models/TrackNet/bounce_train.py` -> `tennisiq/events/bounces.py`
- `models/TennisCourtDetector/tracknet.py` -> `tennisiq/cv/court/model.py`
- `models/TennisCourtDetector/dataset.py` -> `tennisiq/cv/court/dataset.py`
- `models/TennisCourtDetector/main.py` -> `tennisiq/cv/court/train.py`
- `models/TennisCourtDetector/infer_in_*.py` -> `tennisiq/cv/court/infer.py`
- `models/TennisCourtDetector/{court_reference.py,homography.py}` -> `tennisiq/geometry/{court_reference.py,homography.py}`

## Preflight Checks
- [x] Confirm no model weights in repo (`*.pt`, `*.pth`, `*.ckpt`).
- [x] Confirm canonical code exists under `tennisiq/`.
- [x] Confirm only docs mention legacy `models/`.

## Refactor Steps
1. [x] Remove duplicate legacy code directories (`models/`, empty root `pipeline/`).
2. [x] Update `README.md` to remove legacy-retention statement.
3. [x] Run validation:
   - `python3 -m py_compile $(rg --files tennisiq ui -g '*.py')`
   - `python3 - <<'PY' ... import tennisiq.pipeline.run_all ... PY`
4. [x] Record final structure and outcomes below.

## Execution Log
- 2026-02-21: created this plan before deleting any duplicates.
- 2026-02-21: removed `models/` (both legacy subprojects and embedded `.git` folders).
- 2026-02-21: removed empty root `pipeline/` directory.
- 2026-02-21: updated `README.md` note to remove legacy retention wording.
- 2026-02-21: cleaned temporary `__pycache__/` directories generated by checks.
- Final top-level directories:
  - `checkpoints/`, `data/`, `docs/`, `outputs/`, `scripts/`, `tennisiq/`, `ui/`, `.git/`

## Validation Results
- `python3 -m py_compile $(rg --files tennisiq ui -g '*.py' | tr '\\n' ' ')` -> pass
- `python3 - <<'PY' import tennisiq.pipeline.run_all; print('pipeline_import_ok') PY` -> pass
- No remaining duplicate legacy code tree:
  - `models/` -> removed
  - root `pipeline/` -> removed

## Notes On Weights (`.pt`)
- There are no `.pt` files currently present in this repository.
- Expected location for checkpoints is:
  - `checkpoints/ball/best.pt`, `checkpoints/ball/last.pt`
  - `checkpoints/court/best.pt`, `checkpoints/court/last.pt`
- If you have local weights elsewhere, copy/move them into those folders.
